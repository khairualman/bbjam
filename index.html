<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>KitchenSink - Lungo 2.0</title>
    <meta name="description" content="">
    <meta name="author" content="Javier JimÃ©nez Villar (@soyjavi)">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="cleartype" content="on">

    <link rel="stylesheet" href="css/lungo.css">
    <link rel="stylesheet" href="css/lungo.icon.brand.css">
    <link rel="stylesheet" href="css/lungo.icon.css">
    <link rel="stylesheet" href="css/lungo.theme.default.css">
    <link rel="stylesheet" href="css/game.css">
</head>

<body class="app">

    <section id="main" data-transition="slide">
        <header>
            <div class="left">
                <div class="centered title with-subtitle">
                    BBJAM
                    <small class="subtitle">Select a room</small>
                </div>
            </div>
        </header>

        <article id="main-article">
            <div class="selectable list scroll">
                <ul>
                    <li class="anchor">
                        <div class="right blue bubble">
                            <small>Users: 2</small>
                        </div>
                        <strong>ROOM 1</strong>
                    </li>
                    <li>
                        <div class="right blue bubble">
                            <small>Users: 3</small>
                        </div>
                        <strong>ROOM 2</strong>
                    </li>
                    <li>
                        <div class="right blue bubble">
                            <small>Users: 1</small>
                        </div>
                        <strong>ROOM 3</strong>
                    </li>
                </ul>
            </div>


    </section>


    <!-- Lungo dependencies -->
    <script src="js/libs/quo.js"></script>
    <script src="js/libs/lungo.js"></script>
    <script src="js/libs/monocle.js"></script>
    <script src="js/libs/socket.io.js"></script>

    <!-- Lungo dependencies -->
    <script src="js/Instrument.js"></script>
    <script src="js/Instrument.Drum.js"></script>
    <script src="js/Instrument.Guitar.js"></script>
    <script src="js/Instrument.Keyboard.js"></script>
    <script src="js/Instrument.Bass.js"></script>

    <script src="js/mvc/build/app.js"></script>
        <!-- MODELS -->
        <!-- // <script src="js/mvc/models/build/history.js"></script> -->
        <!-- VIEWS -->
        <!-- // <script src="js/mvc/views/build/daily_glycemia.js"></script> -->
        <!-- CONTROLERS -->
        <script src="js/mvc/controllers/build/room.js"></script>
        <script src="js/mvc/controllers/build/configure.js"></script>

    <script>
        Lungo.init({
            name: 'JaM',
            version: '1.0',
            resources: []
        });

        var websocket = io.connect("http://192.168.18.118:6969");
        var room_data = {};
        var my_data = {};

        $$(document).ready(function() {

            $$("#exit-room").tap(function() {
                websocket.emit('exit_room', {
                    room_id: room_data.room_id,
                    name: my_data.user
                });
                Lungo.Router.back();
            });

            $$("#enter-room").tap(function() {
                my_data.user = $$(this).siblings('input').val();
                if(my_data.user != "") {
                    my_data = {
                        room_id: '1',
                        user: my_data.user,
                        instrument: 'banjo',
                        color: 'red'
                    };
                    websocket.emit('start', my_data);
                }
            });
        });

        websocket.on('play', function(data) {
            console.error('Ha tocado :: ', data);
        });

        websocket.on('start_in_room', function(data) {
            if(data.user == my_data.user) {
                my_data.class_name = data.class_name;
                room_data = data.room;
                Lungo.Router.section('#game');
                load_instrument(my_data.instrument);
            } else {
                if(room_data.room_id) {
                    room_data.users.push(data.user);
                    console.error("Ha entrado alguien a la sala :: ", data.user);
                }
            }
        });


        var load_instrument = function(what) {
            switch(what) {
                default:
                    Instrument.Drum.init();
            }
        };

    </script>

</body>
</html>
